generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "mysql"
}

model Product {
  id               Int            @id @default(autoincrement())
  name             String         // searchable
  brand            String?        // searchable
  title            String         // searchable
  description      String?
  price            Int
  stock            Int            @default(0)
  discountPercent  Int?           // filterable
  createdAt        DateTime       @default(now())
  categoryId       Int
  conditionType    ConditionType  @default(NEW)
  conditionPercent Int            @default(100)
  orderItems       OrderItem[]
  category         Category       @relation(fields: [categoryId], references: [id])
  images           ProductImage[]

  @@index([categoryId], map: "Product_categoryId_fkey")
  @@index([name])
  @@index([brand])
  @@index([title])
  @@fulltext([name, brand, title]) // for full-text search
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  productId Int
  url       String
  product   Product @relation(fields: [productId], references: [id])

  @@index([productId], map: "ProductImage_productId_fkey")
}

model Category {
  id        Int       @id @default(autoincrement())
  label     String    @unique
  value     String    @unique
  status    Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model Order {
  id           Int         @id @default(autoincrement())
  userId       Int
  fullName     String
  phone        String
  address      String
  note         String?
  shopNote     String?
  deliveryDate DateTime?
  totalPrice   Int
  status       OrderStatus @default(PENDING)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  user         User        @relation(fields: [userId], references: [id])
  items        OrderItem[]

  @@index([userId], map: "Order_userId_fkey")
}

model OrderItem {
  id               Int           @id @default(autoincrement())
  orderId          Int
  productId        Int
  quantity         Int
  price            Int
  conditionType    ConditionType
  conditionPercent Int
  order            Order         @relation(fields: [orderId], references: [id])
  product          Product       @relation(fields: [productId], references: [id])

  @@index([orderId], map: "OrderItem_orderId_fkey")
  @@index([productId], map: "OrderItem_productId_fkey")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  username  String   @unique
  role      Role     @default(USER)
  phone     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

enum Role {
  ADMIN
  USER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPING
  COMPLETED
  CANCELED
}

enum ConditionType {
  NEW
  LIKE_NEW
  USED
}
